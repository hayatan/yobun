#!/usr/bin/env node
// ============================================================================
// イベント初期データ投入スクリプト
// ============================================================================
// 
// アイランド秋葉原のLINE告知日データを投入します。
// 
// 使用方法:
//   node scripts/seed-events.js
// 
// 注意:
//   - SQLiteデータベースに直接書き込みます
//   - 既存のイベントと重複する場合は無視されます
// ============================================================================

import 'dotenv/config';
import db from '../src/db/sqlite/init.js';
import events from '../src/db/sqlite/events.js';
import eventTypes from '../src/db/sqlite/event-types.js';

// ============================================================================
// アイランド秋葉原のLINE告知日データ（2024年8月〜2026年1月）
// ============================================================================
const LINE_NOTIFICATION_DATES = [
    // 2026年
    '2026-01-21',
    '2026-01-19',
    '2026-01-15',
    '2026-01-09',
    '2026-01-07',
    // 2025年
    '2025-12-19',
    '2025-12-17',
    '2025-12-10',
    '2025-12-04',
    '2025-12-03',
    '2025-11-28',
    '2025-11-21',
    '2025-11-18',
    '2025-11-13',
    '2025-11-12',
    '2025-11-07',
    '2025-11-05',
    '2025-10-29',
    '2025-10-27',
    '2025-10-23',
    '2025-10-15',
    '2025-10-09',
    '2025-10-02',
    '2025-09-25',
    '2025-09-18',
    '2025-09-17',
    '2025-09-12',
    '2025-09-04',
    '2025-08-28',
    '2025-08-25',
    '2025-08-21',
    '2025-08-19',
    '2025-08-07',
    '2025-08-05',
    '2025-07-24',
    '2025-07-17',
    '2025-07-14',
    '2025-07-09',
    '2025-07-03',
    '2025-06-25',
    '2025-06-19',
    '2025-06-17',
    '2025-06-12',
    '2025-06-04',
    '2025-05-30',
    '2025-05-29',
    '2025-05-19',
    '2025-05-14',
    '2025-05-12',
    '2025-05-09',
    '2025-05-08',
    '2025-04-17',
    '2025-04-14',
    '2025-04-10',
    '2025-04-03',
    '2025-03-27',
    '2025-03-24',
    '2025-03-19',
    '2025-03-12',
    '2025-03-05',
    '2025-03-04',
    '2025-02-19',
    '2025-02-13',
    '2025-02-12',
    '2025-02-05',
    '2025-01-23',
    '2025-01-15',
    '2025-01-14',
    '2025-01-09',
    // 2024年
    '2024-12-23',
    '2024-12-19',
    '2024-12-13',
    '2024-12-05',
    '2024-11-21',
    '2024-11-19',
    '2024-11-13',
    '2024-11-07',
    '2024-10-29',
    '2024-10-17',
    '2024-10-15',
    '2024-10-08',
    '2024-09-24',
    '2024-09-19',
    '2024-09-05',
    '2024-08-22',
    '2024-08-19',
];

// ============================================================================
// 初期イベントタイプ
// ============================================================================
const INITIAL_EVENT_TYPES = [
    { name: 'LINE告知', sortOrder: 0 },
];

// ============================================================================
// メイン処理
// ============================================================================
async function main() {
    console.log('='.repeat(60));
    console.log('イベント初期データ投入スクリプト');
    console.log('='.repeat(60));
    
    try {
        // イベントタイプの初期化
        console.log('\n[1/3] イベントタイプを初期化中...');
        const addedTypes = await eventTypes.seedEventTypes(db, INITIAL_EVENT_TYPES);
        console.log(`  → ${addedTypes}件のイベントタイプを追加`);
        
        // イベントデータの作成
        console.log('\n[2/3] イベントデータを作成中...');
        const eventList = LINE_NOTIFICATION_DATES.map(date => ({
            date,
            hole: 'アイランド秋葉原店',
            event: 'LINE告知',
            description: null,
        }));
        console.log(`  → ${eventList.length}件のイベントを準備`);
        
        // イベントの一括投入
        console.log('\n[3/3] イベントを投入中...');
        const addedCount = await events.addEventsBulk(db, eventList);
        console.log(`  → ${addedCount}件のイベントを追加`);
        
        console.log('\n' + '='.repeat(60));
        console.log('完了しました！');
        console.log('='.repeat(60));
        
        // 確認
        const allEvents = await events.getAllEvents(db);
        console.log(`\n登録済みイベント数: ${allEvents.length}件`);
        
        // 最新5件を表示
        console.log('\n最新5件:');
        allEvents.slice(0, 5).forEach(e => {
            console.log(`  ${e.date} | ${e.hole} | ${e.event}`);
        });
        
    } catch (error) {
        console.error('\nエラーが発生しました:', error);
        process.exit(1);
    }
    
    process.exit(0);
}

main();
